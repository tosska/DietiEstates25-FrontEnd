@if (listing) {
  <div [ngClass]="isSidebar ? 
    'w-full max-w-[280px] mb-4 bg-white rounded-2xl shadow-md overflow-hidden border border-olive-100' : 
    'mb-8 bg-white rounded-3xl shadow-xl overflow-hidden border border-olive-100'">
    
    <div class="relative group h-full">
      <img [src]="getMainPhotoUrl(listing)" 
           [alt]="'Foto principale di ' + listing.title"
           [ngClass]="isSidebar ? 'h-40' : 'h-64'" 
           class="object-cover w-full transition-transform duration-700 group-hover:scale-105">
      
      <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent backdrop-blur-[2px]"></div>

      <span class="absolute top-2 right-2 inline-flex items-center rounded-xl font-bold uppercase tracking-wider shadow-sm backdrop-blur-md"
            [ngClass]="isSidebar ? 
              'px-2 py-1 text-[10px] bg-white/90 text-olive-900' : 
              'top-4 right-4 px-3 py-1.5 text-xs' + (listing.status === 'Active' ? ' bg-olive-100/90 text-olive-700 border border-olive-200' : ' bg-yellow-100/90 text-yellow-800 border border-yellow-200')">
        {{ listing.status }}
      </span>

      <div class="absolute bottom-3 left-3 right-3">
        <h2 [ngClass]="isSidebar ? 'text-lg' : 'text-2xl'" class="font-extrabold text-white drop-shadow-md truncate">
          {{ listing.title }}
        </h2>
        <p [ngClass]="isSidebar ? 'text-[11px]' : 'text-sm'" class="mt-0.5 text-olive-50 font-medium drop-shadow-md truncate flex items-center opacity-90">
          <svg class="w-3 h-3 mr-1 inline-block opacity-80" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/></svg>
          {{ listing.Address.city }}
        </p>
      </div>
    </div>

    <div [ngClass]="isSidebar ? 'p-4' : 'p-6'">
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-end gap-2">
        
        <div>
          <p class="text-[10px] font-bold text-olive-900/50 uppercase tracking-widest mb-1">Prezzo</p>
          <span [ngClass]="isSidebar ? 'text-xl' : 'text-3xl'" class="font-black text-olive-500 tracking-tight">
            {{ listing.price | currency:'EUR':'symbol':'1.0-0' }}
          </span>
        </div>

        @if (!isSidebar) {
          <div class="mt-2 sm:mt-0 sm:text-right bg-olive-50 px-3 py-1.5 rounded-lg border border-olive-100">
            <p class="text-[10px] font-bold text-olive-900/50 uppercase tracking-widest">Tipo</p>
            <span class="text-lg font-bold text-olive-900">
              {{ listing.listingType === 'Sale' ? 'Vendita' : 'Affitto' }}
            </span>
          </div>
        }
      </div>
    </div>

    <div [ngClass]="isSidebar ? 'px-4 py-3 space-x-4' : 'px-6 py-4 space-x-8'" 
         class="flex items-center text-olive-900 border-t border-olive-100 bg-olive-50/50">
      
      <div class="flex items-center group" title="Superficie">
        <svg class="w-4 h-4 mr-1.5 text-olive-400 group-hover:text-olive-600 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 1v4m0 0h-4m4 0l-5-5" />
        </svg>
        <span [ngClass]="isSidebar ? 'text-xs' : 'text-sm'" class="font-bold">{{ listing.area }} <span class="text-olive-900/60 font-normal">mÂ²</span></span>
      </div>

      <div class="flex items-center group" title="Numero Stanze">
        <svg class="w-4 h-4 mr-1.5 text-olive-400 group-hover:text-olive-600 transition-colors" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
          <path d="M10 3.5A1.5 1.5 0 0111.5 5v1.5H16a2 2 0 012 2V15a2 2 0 01-2 2H4a2 2 0 01-2-2V8.5a2 2 0 012-2h4.5V5A1.5 1.5 0 0110 3.5zM4 9v6h12V9H4z" />
        </svg>
        <span [ngClass]="isSidebar ? 'text-xs' : 'text-sm'" class="font-bold">{{ listing.numberRooms }} <span class="text-olive-900/60 font-normal">locali</span></span>
      </div>
    </div>
  </div>

} @else {
  <div [ngClass]="isSidebar ? 'w-full max-w-[280px] mb-4' : 'mb-8'" 
       class="bg-white rounded-3xl shadow-xl overflow-hidden animate-pulse border border-olive-100">
    <div [ngClass]="isSidebar ? 'h-40' : 'h-64'" class="bg-olive-100/50"></div>
    <div class="p-6">
      <div class="h-4 bg-olive-100 rounded w-3/4 mb-4"></div>
      <div class="h-8 bg-olive-100 rounded w-1/2"></div>
    </div>
  </div>
}