@if (listing) {
  <div [ngClass]="isSidebar ? 
    'w-full max-w-[280px] mb-4 bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border border-gray-100 dark:border-gray-700' : 
    'mb-8 bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden'">
    
    <div class="relative">
      <img [src]="getMainPhotoUrl(listing)" 
           [alt]="'Foto principale di ' + listing.title"
           [ngClass]="isSidebar ? 'h-40' : 'h-56'" 
           class="object-cover w-full">
      
      <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-black/30 to-transparent"></div>

      <span class="absolute top-2 right-2 inline-flex items-center rounded-full font-semibold"
            [ngClass]="isSidebar ? 'px-2 py-0.5 text-[10px] bg-white/90 text-gray-800' : 'top-4 right-4 px-3 py-1 text-sm' + (listing.status === 'Active' ? ' bg-green-100 text-green-800' : ' bg-yellow-100 text-yellow-800')">
        {{ listing.status }}
      </span>

      <div class="absolute bottom-3 left-3 right-3">
        <h2 [ngClass]="isSidebar ? 'text-lg' : 'text-2xl'" class="font-bold text-white shadow-md truncate">
          {{ listing.title }}
        </h2>
        <p [ngClass]="isSidebar ? 'text-[11px]' : 'text-sm'" class="mt-0.5 text-gray-200 shadow-md truncate">
          {{ listing.Address.city }}
        </p>
      </div>
    </div>

    <div [ngClass]="isSidebar ? 'p-3' : 'p-5'">
      <div class="flex flex-col">
        <div>
          <p class="text-[10px] font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Prezzo</p>
          <span [ngClass]="isSidebar ? 'text-xl' : 'text-3xl'" class="font-bold text-green-600 dark:text-green-400">
            {{ listing.price | currency:'EUR':'symbol':'1.0-0' }}
          </span>
        </div>
        @if (!isSidebar) {
          <div class="mt-4 sm:mt-0 sm:text-right">
            <p class="text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Tipo Annuncio</p>
            <span class="text-xl font-semibold text-gray-900 dark:text-white">
              {{ listing.listingType }}
            </span>
          </div>
        }
      </div>
    </div>

    <div [ngClass]="isSidebar ? 'px-3 py-2 space-x-3' : 'px-5 py-3 space-x-6'" 
         class="flex items-center text-gray-700 dark:text-gray-300 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50">
      
      <div class="flex items-center" title="Superficie">
        <svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 1v4m0 0h-4m4 0l-5-5" />
        </svg>
        <span [ngClass]="isSidebar ? 'text-[11px]' : 'text-sm'">{{ listing.area }} mÂ²</span>
      </div>

      <div class="flex items-center" title="Numero Stanze">
        <svg class="w-4 h-4 mr-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
          <path d="M10 3.5A1.5 1.5 0 0111.5 5v1.5H16a2 2 0 012 2V15a2 2 0 01-2 2H4a2 2 0 01-2-2V8.5a2 2 0 012-2h4.5V5A1.5 1.5 0 0110 3.5zM4 9v6h12V9H4z" />
        </svg>
        <span [ngClass]="isSidebar ? 'text-[11px]' : 'text-sm'">{{ listing.numberRooms }}</span>
      </div>
    </div>
  </div>

} @else {
  <div [ngClass]="isSidebar ? 'w-full max-w-[280px] mb-4' : 'mb-8'" 
       class="bg-white dark:bg-gray-800 rounded-lg shadow-xl overflow-hidden animate-pulse">
    <div [ngClass]="isSidebar ? 'h-40' : 'h-56'" class="bg-gray-300 dark:bg-gray-700"></div>
    <div class="p-4">
      <div class="h-4 bg-gray-300 dark:bg-gray-700 rounded w-3/4 mb-3"></div>
      <div class="h-6 bg-gray-300 dark:bg-gray-700 rounded w-1/2"></div>
    </div>
  </div>
}