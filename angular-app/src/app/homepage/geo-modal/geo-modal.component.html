<div (click)="onClose()" 
     class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm transition-opacity duration-300 ease-in-out">
  
  <div (click)="$event.stopPropagation()" 
       class="relative w-full max-w-[70vw] h-[70vh] bg-white rounded-3xl shadow-2xl border border-olive-100 overflow-hidden flex flex-col transform transition-all duration-300 ease-out">
    
    <div class="flex justify-between items-center p-6 border-b border-olive-100 bg-olive-50">
      <h2 class="text-xl font-extrabold text-olive-900 flex items-center gap-2">
        Mappa Interattiva
      </h2>
      <button (click)="onClose()" class="text-olive-900/40 hover:text-red-500 text-3xl leading-none transition-colors duration-200">&times;</button>
    </div>

    <div class="flex flex-1 h-0 min-h-0 overflow-hidden">
      
      <div class="w-1/3 min-w-[280px] max-w-[320px] bg-olive-50 p-6 border-r border-olive-100 overflow-y-auto custom-scrollbar" 
           [@sidebarFlash]="selectedLocationFromMap?.formatted">
        
        <h2 class="text-lg font-bold mb-4 text-olive-900">Località selezionata</h2>
        
        @if (selectedLocationFromMap; as location) {
          <div class="space-y-3 text-olive-900 text-sm">
            <div class="p-3 bg-white rounded-xl border border-olive-100 shadow-sm">
              <span class="text-[10px] font-bold text-olive-400 uppercase block tracking-wider">Città</span>
              <span class="font-bold text-lg">{{ location.city || '—' }}</span>
            </div>
            <div class="grid grid-cols-2 gap-2">
              <div class="p-3 bg-white rounded-xl border border-olive-100 shadow-sm">
                <span class="text-[10px] font-bold text-olive-400 uppercase block tracking-wider">CAP</span>
                <span class="font-bold">{{ location.postalCode || '—' }}</span>
              </div>
              <div class="p-3 bg-white rounded-xl border border-olive-100 shadow-sm">
                <span class="text-[10px] font-bold text-olive-400 uppercase block tracking-wider">Prov.</span>
                <span class="font-bold">{{ location.state || '—' }}</span>
              </div>
            </div>
          </div>
          
          <div class="mt-8 p-4 bg-white/50 rounded-xl border border-olive-200">
            <label for="radiusRange" class="flex justify-between text-sm font-bold text-olive-900 mb-4">
              Raggio: <span class="text-olive-600 bg-olive-100 px-2 py-0.5 rounded-md">{{ selectedRadius }} km</span>
            </label>
            <input type="range" id="radiusRange" min="1" max="20" step="1" 
                   [(ngModel)]="selectedRadius" (input)="onRadiusChange()" 
                   class="w-full accent-olive-500 cursor-pointer" />
            <div class="flex justify-between text-[10px] text-olive-400 font-bold mt-2">
              <span>1km</span>
              <span>20km</span>
            </div>
          </div>
        } @else {
          <div class="h-full flex flex-col items-center justify-center text-olive-900/50 text-center p-8">
            <p class="text-lg font-bold leading-relaxed">
              Clicca sulla mappa per<br>selezionare una zona.
            </p>
          </div>
        }
      </div>
      
      <div class="flex-1 h-full relative z-0 bg-gray-100">
        <app-geo-map [height]="'100%'" [circleRadiusKm]="selectedRadius" (selectedLocationEvent)="setLocation($event)"></app-geo-map>
      </div>
    </div>
    
    <div class="p-6 bg-white border-t border-olive-100 flex justify-end">
      <button (click)="onConfirmLocation()" 
              class="bg-olive-500 hover:bg-olive-400 text-white font-bold py-3 px-8 rounded-2xl shadow-lg shadow-olive-200 transition-all transform active:scale-95 flex items-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
        Conferma Località
      </button>
    </div>
  </div>
</div>