<form (ngSubmit)="handleSearch()" class="w-full max-w-6xl mx-auto bg-white p-3 rounded-3xl shadow-2xl flex flex-col sm:flex-row items-center gap-4 transition-all duration-300 transform border border-olive-100">
  <div class="relative w-full sm:flex-grow group">
    <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400 transition-colors duration-300 group-focus-within:text-olive-500 pointer-events-none" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
    </svg>
    <input type="text" autocomplete="off" placeholder="Dove vuoi cercare? (es. citt√†, zona)" class="w-full rounded-full pl-12 pr-6 py-3 bg-olive-50 text-olive-900 shadow-inner ring-1 ring-inset ring-transparent focus:ring-2 focus:ring-olive-500 placeholder:text-gray-400 text-base font-medium transition duration-300 focus:bg-white" name="searchQuery" (focus)="onFocus($event)" [(ngModel)]="searchQuery" (blur)="hideDropdownWithDelay()" (keyup)="onInput($event)" />

    @if(dropdownVisibleSuggestions) {
      <div class="absolute left-0 right-0 mt-2 bg-white border border-olive-200 rounded-lg shadow-lg z-10">
        @for (suggestion of suggestedAddresses; track $index) {
          <button type="button" (click)="onSelectLocation(suggestion)" class="w-full text-left px-4 py-2 text-sm text-olive-900 hover:bg-olive-50 rounded-t-lg transition-colors">
            {{ suggestion.formatted }}
          </button>
        }
      </div>
    }

    @if (dropdownVisibleMap) {
      <div class="absolute left-0 right-0 mt-2 bg-white border border-olive-200 rounded-lg shadow-lg z-10">
        <button type="button" (mousedown)="onMapSearchClick()" class="w-full text-left px-4 py-2 text-sm text-olive-900 hover:bg-olive-50 rounded-t-lg font-medium">
          üîç Ricerca su mappa interattiva
        </button>
      </div>
    }
  </div>

  <div class="flex items-center gap-4 w-full sm:w-auto">
    <div class="relative w-full sm:w-48">
      <select name="propertyType" [(ngModel)]="selectedPropertyType" class="w-full rounded-full px-6 py-3 bg-olive-50 text-olive-900 shadow-inner ring-1 ring-inset ring-transparent focus:ring-2 focus:ring-olive-500 text-sm font-medium transition duration-300 cursor-pointer appearance-none" style="background-image: url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%2020%2020%22%20fill%3D%22%232D4014%22%3E%3Cpath%20fill-rule%3D%22evenodd%22%20d%3D%22M5.293%207.293a1%201%200%20011.414%200L10%2010.586l3.293-3.293a1%201%200%20111.414%201.414l-4%204a1%201%200%2001-1.414%200l-4-4a1%201%200%20010-1.414z%22%20clip-rule%3D%22evenodd%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 1.5rem center; background-size: 1.2em;">
        <option [ngValue]="null" disabled>Seleziona tipo</option>
        @for (prop of propertyTypes; track prop.id) {
          <option [value]="prop.name">{{ listingService.propertiesMapping[prop.name] }}</option>
        }
      </select>
    </div>

    <button type="button" (click)="openFilters()" class="w-full sm:w-auto flex items-center justify-center bg-white border border-olive-200 text-olive-900 font-semibold px-4 py-3 rounded-full hover:bg-olive-50 focus:outline-none focus:ring-2 focus:ring-olive-500 transition-all duration-300 shadow-sm hover:shadow-md">
      <svg class="h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707v5.586a1 1 0 01-1.6.8L8 21V12.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
      </svg>
      <span class="hidden sm:block">Filtri</span>
    </button>

    <button type="submit" class="w-full sm:w-auto flex items-center justify-center bg-olive-500 text-white font-bold px-6 py-3 rounded-full hover:bg-olive-400 focus:outline-none focus:ring-2 focus:ring-olive-500 transition duration-300 shadow-lg transform active:scale-95">
      <svg class="h-5 w-5 sm:mr-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.828 0l-4.243-4.243a8 8 0 1111.314 0z"/>
        <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
      </svg>
      <span class="hidden sm:block">Cerca</span>
    </button>
  </div>
</form>

